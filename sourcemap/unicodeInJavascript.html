<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <title>Unicode in JavaScript | 卑鄙智</title><meta name="description" content=""><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="VuePress 2.0.0-beta.22">
    <link rel="preload" href="/blog-site/assets/js/runtime~app.b8391e89.js" as="script"><link rel="preload" href="/blog-site/assets/css/styles.ec008df3.css" as="style"><link rel="preload" href="/blog-site/assets/js/4640.d13a5239.js" as="script"><link rel="preload" href="/blog-site/assets/js/app.20f347e0.js" as="script">
    <link rel="stylesheet" href="/blog-site/assets/css/styles.ec008df3.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button"><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><span><a href="/blog-site/" class=""><img class="logo" src="/blog-site/assets/logo.jpeg" alt="卑鄙智"><span class="site-name can-hide">卑鄙智</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Vue 源码合集"><span class="title">Vue 源码合集</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Vue 源码合集"><span class="title">Vue 源码合集</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/blog-site/vue2/README.md" class="nav-link" aria-label="v2"><!--[--><!--]--> v2 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/blog-site/vue3/README.md" class="nav-link" aria-label="v3"><!--[--><!--]--> v3 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="webpack 源码合集"><span class="title">webpack 源码合集</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="webpack 源码合集"><span class="title">webpack 源码合集</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/blog-site/webpack4/README.md" class="nav-link" aria-label="v4.46.0"><!--[--><!--]--> v4.46.0 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/blog-site/webpack5/README.md" class="nav-link" aria-label="v5"><!--[--><!--]--> v5 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="计算机基础知识"><span class="title">计算机基础知识</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="计算机基础知识"><span class="title">计算机基础知识</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/blog-site/networks/README.md" class="nav-link" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/blog-site/nginx/README.md" class="nav-link" aria-label="nginx"><!--[--><!--]--> nginx <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/theniceangel" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Vue 源码合集"><span class="title">Vue 源码合集</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Vue 源码合集"><span class="title">Vue 源码合集</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/blog-site/vue2/README.md" class="nav-link" aria-label="v2"><!--[--><!--]--> v2 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/blog-site/vue3/README.md" class="nav-link" aria-label="v3"><!--[--><!--]--> v3 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="webpack 源码合集"><span class="title">webpack 源码合集</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="webpack 源码合集"><span class="title">webpack 源码合集</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/blog-site/webpack4/README.md" class="nav-link" aria-label="v4.46.0"><!--[--><!--]--> v4.46.0 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/blog-site/webpack5/README.md" class="nav-link" aria-label="v5"><!--[--><!--]--> v5 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="计算机基础知识"><span class="title">计算机基础知识</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="计算机基础知识"><span class="title">计算机基础知识</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/blog-site/networks/README.md" class="nav-link" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/blog-site/nginx/README.md" class="nav-link" aria-label="nginx"><!--[--><!--]--> nginx <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/theniceangel" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item active">sourcemap</p><ul class=""><li><!--[--><a href="/blog-site/sourcemap/base64.html" class="nav-link sidebar-item" aria-label="Base64"><!--[--><!--]--> Base64 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/blog-site/sourcemap/" class="nav-link router-link-active sidebar-item" aria-label="sourcemap"><!--[--><!--]--> sourcemap <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blog-site/sourcemap/unicodeInJavascript.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="Unicode in JavaScript"><!--[--><!--]--> Unicode in JavaScript <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/blog-site/sourcemap/unicodeInJavascript.html#unicode" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Unicode"><!--[--><!--]--> Unicode <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blog-site/sourcemap/unicodeInJavascript.html#utf-16" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="UTF-16"><!--[--><!--]--> UTF-16 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blog-site/sourcemap/unicodeInJavascript.html#babylon-fullcharcodeatpos" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="babylon fullCharCodeAtPos"><!--[--><!--]--> babylon fullCharCodeAtPos <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blog-site/sourcemap/unicodeInJavascript.html#utf-8" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="UTF-8"><!--[--><!--]--> UTF-8 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blog-site/sourcemap/unicodeInJavascript.html#unicode-in-javascript-1" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Unicode In JavaScript"><!--[--><!--]--> Unicode In JavaScript <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blog-site/sourcemap/unicodeInJavascript.html#总结" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="unicode-in-javascript" tabindex="-1"><a class="header-anchor" href="#unicode-in-javascript" aria-hidden="true">#</a> Unicode in JavaScript</h1><p>最近在学习 <a href="https://github.com/babel/babylon" target="_blank" rel="noopener noreferrer">babylon<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 的词法解析，发现了一段很有趣的代码，百思不得其解。</p><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#24292e;"><code><span class="line"><span style="color:#6A737D;">// this.input 输入的字符串</span></span>
<span class="line"><span style="color:#6A737D;">// this.state.pos 当前解析字符串的索引</span></span>
<span class="line"><span style="color:#B392F0;">fullCharCodeAtPos</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">code</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.input.</span><span style="color:#B392F0;">charCodeAt</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.state.pos);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (code </span><span style="color:#F97583;">&lt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xd7ff</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> code </span><span style="color:#F97583;">&gt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xe000</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> code;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">next</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.input.</span><span style="color:#B392F0;">charCodeAt</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.state.pos </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> (code </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> next </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x35fdc00</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span></code></pre></div><p>从方法名可知，目的是为了获取某个字符的 unicode 编码单元（code point）。按道理，通过 <code>charCodeAt</code> 方案就可以返回某个字符的编码单元，后面的 <strong>if</strong> 语句的作用是什么？</p><p>遇到了问题，先上 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/charCodeAt" target="_blank" rel="noopener noreferrer">MDN<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 查了一下 <strong>charCodeAt</strong> 的文档。</p><blockquote><p>The <strong>charCodeAt()</strong> method returns an integer between 0 and 65535 representing the UTF-16 code unit at the given index. charCodeAt 方法返回一个介于0和65535之间的整数，该整数表示给定索引处的UTF-16编码单元。</p></blockquote><p>从上述来看，如果编码单元超过 65535，那么 <strong>charCodeAt</strong> 方法就无效了，但是为什么阈值是 65535 呢，编码单元什么时候会超过 65535 呢。带着这个疑问，我在谷歌上收集了若干资料，发现这是一个巨大的坑。</p><h2 id="unicode" tabindex="-1"><a class="header-anchor" href="#unicode" aria-hidden="true">#</a> Unicode</h2><p>计算机只处理数字，所以存储任何一个信息，必须要有一个唯一的标志，不同国家也设计过不同的标准，比如 ASCII，GB2312、GBK、GB18030 而 Unicode 的产生就是为了解决传统的字符集的局限性问题，并且覆盖世界上任何语言的字符。它从 0 开始，为每个字符映射一个唯一编号，形式为 <code>U+x{4,6}</code>，<code>x</code> 为十六进制数，最少 4 位，最多 6 位。</p><div class="language-text ext-text"><pre class="shiki" style="background-color:#24292e;"><code><span class="line"><span style="color:#e1e4e8;">U+4e00 = &quot;一&quot; // 中文&quot;一&quot;
</span></span></code></pre></div><p>上述的四位十六进制数就是 Unicode 的编码单元，也叫做<strong>码点(code point)</strong>，范围从 <code>U+0000</code> 到 <code>U+10FFFF</code>，总共包含 1114112 (17 * $2^{20}$)个码点。</p><h2 id="utf-16" tabindex="-1"><a class="header-anchor" href="#utf-16" aria-hidden="true">#</a> UTF-16</h2><p>Unicode 只是规定了每个字符的码点，那对于文件具体要怎么编码，就牵涉到编码方法，有 UTF-8，UTF-16，UTF-32 等等，先了解一下 UTF-16，因为根据 MDN 的 <code>charCodeAt</code> 方法描述就提及到 UTF-16 码点。</p><ol><li><p><strong>基本定义</strong></p><table><thead><tr><th>编码范围</th><th>字节</th><th>名称</th></tr></thead><tbody><tr><td>0x0000 - 0xFFFF</td><td>2</td><td>Basic Multilingual Plane</td></tr><tr><td>0x10000 - 0x10FFFF</td><td>4</td><td>Supplementary Multilingual Plane</td></tr></tbody></table><p>UTF-16 编码的特点就是<strong>定长</strong>和<strong>变长</strong>，它将所有的码点分为两个范围，其中 <code>0x0000 - 0xFFFF</code> 代表<strong>基本多语言平面（BMP）</strong>，包含了我们大多数通用的字符，其余的就是<strong>补充多语言平面（SMP）</strong>，BMP 的字符码点的最大值是 <code>0xFFFF</code>(<strong>$2^{16}$</strong>)，也就是 65536，因为一个字节需要 8 个二进制位，那么要表示 BMP 的字符码点则需要 2 个字节。那么对于 <strong>SMP</strong>，字符共有 <strong>$2^{20}$</strong> 个，也就是需要 20 个二进制位才能完全唯一映射，那么就产生了<strong>代理对</strong>(Surrogate pairs)的概念。</p></li><li><p><strong>代理对</strong></p><p>由于<strong>补充多语言平面</strong>的字符共有 <strong>$2^{20}$</strong> 个，而且<strong>基本多语言平面</strong>内，从 <code>U+D800</code> 到 <code>U+DFFF</code> 是一个空段，也就是这些码点不映射任何字符，总共有 <strong>$2^{11}$</strong> 个，UTF-16 将<strong>补充多语言平面</strong>的 20 位拆成两半，前 10 位映射在 U+D800 到 U+DBFF（空间大小 $2^{10}$），称为高位（H），后10位映射在U+DC00 到 U+DFFF（空间大小 $2^{10}$），称为低位（L），它们组成了<strong>代理对</strong>，也就是说<strong>补充多语言平面</strong>的字符是由两个<strong>基本多语言平面</strong>的字符表示。</p></li><li><p><strong>UTF-16的转码公式</strong></p><p>举个例子，如果是<strong>基本多语言平面的字符</strong>，直接转换成十六进制即可。比如版权符号“©️”，它的码点是 <code>U+00A9</code>。</p><div class="language-text ext-text"><pre class="shiki" style="background-color:#24292e;"><code><span class="line"><span style="color:#e1e4e8;">U+00A9 = 0x00A9
</span></span></code></pre></div><p>那么对于<strong>补充多语言平面</strong>，“𠮷”字，它的码点是 <code>U+20BB7</code>，UTF-16 给出的公式是：</p><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#24292e;"><code><span class="line"><span style="color:#6A737D;">// C 是码点，对应上面的 0x20BB7</span></span>
<span class="line"><span style="color:#79B8FF;">H</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Math</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">floor</span><span style="color:#E1E4E8;">((</span><span style="color:#79B8FF;">C</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x10000</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x400</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xD800</span></span>
<span class="line"><span style="color:#79B8FF;">L</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">C</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x10000</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x400</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xDC00</span></span>
<span class="line"></span></code></pre></div><p>通过计算可以得出它的高位是 <code>\ud842</code>，低位是 <code>\udfb7</code>，如果你在浏览器的控制台打印如下，可以发现</p><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#24292e;"><code><span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#79B8FF;">\ud842\udfb7</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;">// 打印:&quot;𠮷&quot;</span></span>
<span class="line"></span></code></pre></div><p>如果你打印它的 length，你会更惊讶！</p><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#24292e;"><code><span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;𠮷&quot;</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;">// 打印: 2</span></span>
<span class="line"></span></code></pre></div><p><strong>如果你是做一个表单 textarea 限制字数的功能，会不会感觉头疼？</strong></p><p>当然在 JavaScript 你也许会碰到更多神奇的事情，这个下文会提及。</p></li><li><p><strong>高低位是如何拆分的</strong></p><p>我是一个好奇心比较强的人，上文提及到这样一段话，当然也是我查资料得到的。</p><blockquote><p><strong>基本多语言平面</strong>内，从 <code>U+D800</code> 到 <code>U+DFFF</code> 是一个空段，也就是这些码点不映射任何字符，总共有 <strong>$2^{11}$</strong> 个，UTF-16 将<strong>补充多语言平面</strong>的 20 位拆成两半，前 10 位映射在 U+D800 到 U+DBFF（空间大小 $2^{10}$），称为高位（H），后 10 位映射在U+DC00 到 U+DFFF（空间大小 $2^{10}$），称为低位（L）。</p></blockquote><p>仔细想想，<strong>前 10 位映射在高位区间，后 10 位映射在低位区间，到底是怎么映射的？</strong></p><p>这里牵涉到一个<a href="https://www.ietf.org/rfc/rfc2781.txt" target="_blank" rel="noopener noreferrer">具体的公式<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>，查看 2.1 节，</p><div class="language-text ext-text"><pre class="shiki" style="background-color:#24292e;"><code><span class="line"><span style="color:#e1e4e8;">// 假设补充多语言平面字符的码点为 U，

// 转化成二进制
1) Let U&#39; = (U - 0x10000) .toString(2)

// (如果不够 20 位，高位补 0)，得到 20 位的二进制数
U&#39; = yyyyyyyyyyxxxxxxxxxx

// 前面十位落在高位（起点就是 `U+D800`，转换成二进制就是 1101100000000000）
H = 110110yyyyyyyyyy
// 后面十位落在低位（起点就是 `U+DC00`，转换成二进制就是 1101110000000000）
L = 110111xxxxxxxxxx
</span></span></code></pre></div><p>为了验证一下这个公式，继续拿上面的 &quot;𠮷&quot; 举个例子。</p><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#24292e;"><code><span class="line"><span style="color:#6A737D;">// 第一步 换算成二进制</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">U</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">0x20BB7</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x10000</span><span style="color:#E1E4E8;">) .</span><span style="color:#B392F0;">toString</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;">// &quot;10000101110110111&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 第二步 高位补 0</span></span>
<span class="line"><span style="color:#79B8FF;">U</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;00010000101110110111&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 第三步 截取字符串，得到高低位</span></span>
<span class="line"><span style="color:#79B8FF;">H</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;110110&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;0001000010&quot;</span></span>
<span class="line"><span style="color:#79B8FF;">L</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;110111&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;1110110111&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 第四部 二进制换算成十六进制</span></span>
<span class="line"><span style="color:#79B8FF;">H</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xd842</span></span>
<span class="line"><span style="color:#79B8FF;">L</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xdfb7</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 与UTF-16的转码公式的结果一模一样，印证了代理对的原理</span></span>
<span class="line"></span></code></pre></div></li></ol><h2 id="babylon-fullcharcodeatpos" tabindex="-1"><a class="header-anchor" href="#babylon-fullcharcodeatpos" aria-hidden="true">#</a> babylon fullCharCodeAtPos</h2><p>熟悉 UTF-16 代理对的概念之后，回到文章开头的那段 <code>fullCharCodeAtPos</code> 中的 <strong>if</strong> 语句，因为如果碰到<strong>补充多语言平面</strong>的字符， charCodeAt 返回的是代理对的高位码点，代理对的区间是[0xD800, 0xDFFF]，所以只要是不在这个区间，表明是<strong>基本多语言平面</strong>的字符，否则再获取代理对的低位码点，通过下面的算法计算<strong>补充多语言平面</strong>字符的 Unicode 码点。</p><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#24292e;"><code><span class="line"><span style="color:#6A737D;">// this.input 输入的字符串</span></span>
<span class="line"><span style="color:#6A737D;">// this.state.pos 当前解析字符串的索引</span></span>
<span class="line"><span style="color:#B392F0;">fullCharCodeAtPos</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">code</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.input.</span><span style="color:#B392F0;">charCodeAt</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.state.pos);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (code </span><span style="color:#F97583;">&lt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xd7ff</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> code </span><span style="color:#F97583;">&gt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xe000</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> code;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">next</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.input.</span><span style="color:#B392F0;">charCodeAt</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.state.pos </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> (code </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> next </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x35fdc00</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="utf-8" tabindex="-1"><a class="header-anchor" href="#utf-8" aria-hidden="true">#</a> UTF-8</h2><p>UTF-16 需要至少 2 个或者 4 个字节，其实对于字符 &quot;a&quot; 来说，它的码点是 <code>U+0061</code>，其实只需要一个字节，也就是 8 位二进制数表示即可，对于 UTF-16，高位都必须补 0，从而浪费空间，那么 UTF-8 的优势就凸显出来了，<strong>UTF-8是一种变长的编码方法，字符长度从1个字节到4个字节不等，最前面的128个字符，只使用1个字节表示，与 ASCII 码完全相同</strong>，因此更节省空间。</p><ol><li><p><strong>基本定义</strong></p><table><thead><tr><th>编码范围</th><th>字节</th></tr></thead><tbody><tr><td>0x0000 - 0x007F</td><td>1</td></tr><tr><td>0x0080 - 0x07FF</td><td>2</td></tr><tr><td>0x0800 - 0xFFFF</td><td>3</td></tr><tr><td>0x010000 - 0x10FFFF</td><td>4</td></tr></tbody></table><p>对于 UTF-8 来说，字符的码点处于不同区间，那么字节数也不一样，那如果我读取文件，怎么判断应该读取一个还是多个字节来组成字符呢，这就牵涉到 UTF-8 的转码公式。</p></li><li><p><strong>UTF-8的转码公式</strong></p><table><thead><tr><th>Unicode符号范围</th><th>UTF-8编码方式</th></tr></thead><tbody><tr><td>0x0000 - 0x007F</td><td>0xxxxxxx</td></tr><tr><td>0x0080 - 0x07FF</td><td>110xxxxx 10xxxxxx</td></tr><tr><td>0x0800 - 0xFFFF</td><td>1110xxxx 10xxxxxx 10xxxxxx</td></tr><tr><td>0x010000 - 0x10FFFF</td><td>11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</td></tr></tbody></table><p>步骤如下：</p><ol><li>对于单字节，也就 Unicode 码点小于 128 的字符，最高位是 <code>0</code>，其余位都是这个符号的 Unicode 码点值的二进制。</li><li>对于 <strong>n</strong>(<strong>n</strong> &gt;= <strong>2</strong>) 字节，第一个字节的前 <strong>n</strong> 位都设为 1，第 <strong>n + 1</strong> 位设为 0，后面字节的前两位一律设为<strong>10</strong>。剩下的没有提及的二进制位，全部为这个符号的 Unicode 码点的二进制（<strong>从低位开始填充，如果位数不够，那么高位补 0 即可</strong>）。</li></ol><p>很多人对步骤二很疑惑，那么举个例子。汉字<code>一</code>的 Unicode 码点值是 <code>U+4E00</code>，转换成二进制是 &quot;100111000000000&quot;。</p><p>查上面表格，<code>一</code> 是处于第三行的区间，也就是三个字节长，那么将转换的二进制从右向左开始填充，得到下面。</p><div class="language-text ext-text"><pre class="shiki" style="background-color:#24292e;"><code><span class="line"><span style="color:#e1e4e8;">1110{0}100 10111000 10000000 // 大括号的 0 则是高位补 0

// 转换成十六进制: 0xE4B880，三个字节
</span></span></code></pre></div></li></ol><p>以上就是 UTF-16 和 UTF-8 的基本要点，接下来要谈谈 <code>Unicode In JavaScript</code>。</p><h2 id="unicode-in-javascript-1" tabindex="-1"><a class="header-anchor" href="#unicode-in-javascript-1" aria-hidden="true">#</a> Unicode In JavaScript</h2><p>首先 JavaScript 采用的是 &quot;Unicode&quot; 字符集，那么编码方法是什么呢？有<a href="https://mathiasbynens.be/notes/javascript-encoding" target="_blank" rel="noopener noreferrer">权威人士<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>给出了答案。</p><blockquote><p>从 JS 的引擎来说是采用 UTF-16， 从 JS 的语言设计来说，采用的是 UCS-2</p></blockquote><p>对于我们开发者来说，就是怎样去解决以下的 JavaScript 问题？</p><ol><li><p><strong>获取字符码点</strong></p><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#24292e;"><code><span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> s </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;𠮷&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">s.</span><span style="color:#B392F0;">charCodeAt</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;">// 55362 错了！获取到的只是代理对的高位</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// ES6</span></span>
<span class="line"><span style="color:#E1E4E8;">s.</span><span style="color:#B392F0;">codePointAt</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;">// 134071 正确！</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 低版本兼容——MDN 版本一</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">codePointAt</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">position</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">TypeError</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> string </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">String</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> size </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> string.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// `ToInteger`</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> index </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> position </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Number</span><span style="color:#E1E4E8;">(position) </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (index </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> index) { </span><span style="color:#6A737D;">// better `isNaN`</span></span>
<span class="line"><span style="color:#E1E4E8;">    index </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// Account for out-of-bounds indices:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (index </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> index </span><span style="color:#F97583;">&gt;=</span><span style="color:#E1E4E8;"> size) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">undefined</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// Get the first code unit</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> first </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> string.</span><span style="color:#B392F0;">charCodeAt</span><span style="color:#E1E4E8;">(index);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> second;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> ( </span><span style="color:#6A737D;">// check if it’s the start of a surrogate pair</span></span>
<span class="line"><span style="color:#E1E4E8;">    first </span><span style="color:#F97583;">&gt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xD800</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> first </span><span style="color:#F97583;">&lt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xDBFF</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// high surrogate</span></span>
<span class="line"><span style="color:#E1E4E8;">    size </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> index </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// there is a next code unit</span></span>
<span class="line"><span style="color:#E1E4E8;">  ) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    second </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> string.</span><span style="color:#B392F0;">charCodeAt</span><span style="color:#E1E4E8;">(index </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (second </span><span style="color:#F97583;">&gt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xDC00</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> second </span><span style="color:#F97583;">&lt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xDFFF</span><span style="color:#E1E4E8;">) { </span><span style="color:#6A737D;">// low surrogate</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// https://mathiasbynens.be/notes/javascript-encoding#surrogate-formulae</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> (first </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xD800</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x400</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> second </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xDC00</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x10000</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> first;</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 低版本兼容——Babylon 版本二</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">fullCharCodeAtPos</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">input</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">code</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> input.</span><span style="color:#B392F0;">charCodeAt</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (code </span><span style="color:#F97583;">&lt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xd7ff</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> code </span><span style="color:#F97583;">&gt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xe000</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> code;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">next</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> input.</span><span style="color:#B392F0;">charCodeAt</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> (code </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> next </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x35fdc00</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span></code></pre></div></li><li><p><strong>字符串长度</strong></p><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#24292e;"><code><span class="line"><span style="color:#9ECBFF;">&quot;𠮷&quot;</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// &quot;𠮷&quot; 的 Unicode 码点属于补充多语言平面</span></span>
<span class="line"><span style="color:#6A737D;">// 由两个基本多语言平面的码点组成代理对，长度为 2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 解决一：</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">punycode</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;punycode&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">punycode.ucs2.</span><span style="color:#B392F0;">decode</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;𠮷&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 解决二：</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> regexAstralSymbols </span><span style="color:#F97583;">=</span><span style="color:#DBEDFF;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#79B8FF;">[\uD800-\uDBFF][\uDC00-\uDFFF]</span><span style="color:#9ECBFF;">/</span><span style="color:#F97583;">g</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">countSymbols</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">string</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> string</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Replace every surrogate pair with a BMP symbol.</span></span>
<span class="line"><span style="color:#E1E4E8;">    .</span><span style="color:#B392F0;">replace</span><span style="color:#E1E4E8;">(regexAstralSymbols, </span><span style="color:#9ECBFF;">&#39;_&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// …and *then* get the length.</span></span>
<span class="line"><span style="color:#E1E4E8;">    .</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#B392F0;">countSymbols</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;𠮷&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// ES6 方案</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">countSymbols</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">string</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Array</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">from</span><span style="color:#E1E4E8;">(string).</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">countSymbols</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;𠮷&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">countSymbols</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">string</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> [</span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">string].</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">countSymbols</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;𠮷&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 1</span></span>
<span class="line"></span></code></pre></div></li><li><p><strong>字符串反转</strong></p><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#24292e;"><code><span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;abc&quot;</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">split</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">reverse</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;">// &quot;cba&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;𠮷&quot;</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">split</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">reverse</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;">// &quot;??&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// &quot;𠮷&quot; 反转其实是将 &quot;\ud842\udfb7&quot; 反转</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 变成 &quot;\udfb7\ud842&quot;，自然不识别</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 解决：</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">esrever</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;esrever&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(esrever.</span><span style="color:#B392F0;">reverse</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;𠮷&#39;</span><span style="color:#E1E4E8;">)) </span><span style="color:#6A737D;">// &quot;𠮷&quot;</span></span>
<span class="line"></span></code></pre></div></li><li><p><strong>正则表达式</strong></p><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#24292e;"><code><span class="line"><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">foo</span><span style="color:#79B8FF;">.</span><span style="color:#DBEDFF;">bar</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">test</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;foo💩bar&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;">// false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// ES6</span></span>
<span class="line"><span style="color:#9ECBFF;">/</span><span style="color:#DBEDFF;">foo</span><span style="color:#79B8FF;">.</span><span style="color:#DBEDFF;">bar</span><span style="color:#9ECBFF;">/</span><span style="color:#F97583;">u</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">test</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;foo💩bar&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;">// true</span></span>
<span class="line"></span></code></pre></div><p>上述说明<code>.</code>只能匹配 <code>💩</code>（<code>&quot;\ud83d\udca9&quot;</code>） 的代理对的高位 <code>&quot;\ud83d&quot;</code>，但是 ES6 加了一个 <code>u</code> flag 来支持。</p><p>也可以通过如下的正则，详情可以参考 <a href="https://mths.be/regenerate" target="_blank" rel="noopener noreferrer">Regenerate<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>：</p><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#24292e;"><code><span class="line"><span style="color:#9ECBFF;">/</span><span style="color:#79B8FF;">[</span><span style="color:#85E89D;font-weight:bold;">\0</span><span style="color:#79B8FF;">-\uD7FF\uE000-\uFFFF]</span><span style="color:#F97583;">|</span><span style="color:#79B8FF;">[\uD800-\uDBFF][\uDC00-\uDFFF]</span><span style="color:#F97583;">|</span><span style="color:#79B8FF;">[\uD800-\uDBFF]</span><span style="color:#DBEDFF;">(?!</span><span style="color:#79B8FF;">[\uDC00-\uDFFF]</span><span style="color:#DBEDFF;">)</span><span style="color:#F97583;">|</span><span style="color:#DBEDFF;">(?:</span><span style="color:#79B8FF;">[</span><span style="color:#F97583;">^</span><span style="color:#79B8FF;">\uD800-\uDBFF]</span><span style="color:#F97583;">|^</span><span style="color:#DBEDFF;">)</span><span style="color:#79B8FF;">[\uDC00-\uDFFF]</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">test</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;💩&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;">// true! wtf~~</span></span>
<span class="line"></span></code></pre></div></li></ol><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>从上面的解决方案来看，ES6 对 Unicode 还是得到部分增强，如果你理解了上面的 UTF-16 编码，阅读<a href="https://es6.ruanyifeng.com/#docs/string" target="_blank" rel="noopener noreferrer">阮老师的 ES6 字符串的扩展<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>也觉得毫无压力了。如果你遇到 Unicode 的问题，尤其是做关于<strong>表单</strong>，<strong>富文本 emoji</strong> 等相关功能的时候，可以找 <a href="https://github.com/mathiasbynens" target="_blank" rel="noopener noreferrer">Mathias Bynens<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 获取一些答案，他是这方面的权威专家。</p><p>参考资料：</p><p>https://zh.wikipedia.org/wiki/Unicode</p><p><a href="https://mathiasbynens.be/notes/javascript-encoding" target="_blank" rel="noopener noreferrer">javascript-encoding<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p><a href="https://mathiasbynens.be/notes/javascript-unicode" target="_blank" rel="noopener noreferrer">javascript-unicode<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p><a href="https://www.ietf.org/rfc/rfc2781.txt" target="_blank" rel="noopener noreferrer">UTF-16 RFC<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><p>http://www.ruanyifeng.com/blog/2014/12/unicode.html</p><p>https://unicode-table.com/en/#control-character</p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/theniceangel/edit/main/sourcemap/unicodeInJavascript.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">2021/9/15 上午10:27:57</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: jizhi@didiglobal.com">jizhi</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/blog-site/sourcemap/" class="nav-link router-link-active" aria-label="sourcemap"><!--[--><!--]--> sourcemap <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main></div><!----><!--]--></div>
    <script src="/blog-site/assets/js/runtime~app.b8391e89.js" defer></script><script src="/blog-site/assets/js/4640.d13a5239.js" defer></script><script src="/blog-site/assets/js/app.20f347e0.js" defer></script>
  </body>
</html>
